'use strict';
var modifyFilename = require('modify-filename');

module.exports = function (pth, hash) {
    if (arguments.length !== 2) {
        throw new Error('`path` and `hash` required');
    }
    function timestamp() {//时间戳
        var date = new Date();
        var year = date.getFullYear();
        var month = _completion(date.getMonth() + 1);
        var d = _completion(date.getDate());
        var hours = _completion(date.getHours());
        var minutes = _completion(date.getMinutes());
        return year.toString() + month.toString() + d.toString() + hours.toString() + minutes.toString();
        function _completion(n) {//小于10自动补0
            if (typeof n != "number") {
                return NaN;
            }
            if (n >= 0 && n < 10) {
                return "0" + n
            } else {
                return n;
            }
        }
    }

    return modifyFilename(pth, function (filename, ext) {
        return filename + '-' + hash + '-' + timestamp() + ext;
    });
};

module.exports.revert = function (pth, hash) {
    if (arguments.length !== 2) {
        throw new Error('`path` and `hash` required');
    }

    return modifyFilename(pth, function (filename, ext) {
        return filename.replace(new RegExp('-' + hash + '$'), '') + ext;
    });
};
